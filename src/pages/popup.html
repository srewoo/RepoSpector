<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RepoSpector - Because Your Code Deserves a Safety Net</title>
    <link rel="stylesheet" href="../assets/styles/popup.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">RepoSpector</h1>
            <p class="tagline">Because Your Code Deserves a Safety Net</p>
            <div class="header-info">
                <button id="settingsBtn" class="settings-btn" title="Settings">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 12.5C11.3807 12.5 12.5 11.3807 12.5 10C12.5 8.61929 11.3807 7.5 10 7.5C8.61929 7.5 7.5 8.61929 7.5 10C7.5 11.3807 8.61929 12.5 10 12.5Z" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M10 2.5V5M10 15V17.5M17.5 10H15M5 10H2.5M15.303 4.697L13.536 6.464M6.464 13.536L4.697 15.303M15.303 15.303L13.536 13.536M6.464 6.464L4.697 4.697" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
        </header>

        <main class="main-content">
            <!-- Progress Container -->
            <div id="progressContainer" class="progress-container" style="display: none;">
                <div class="progress-steps">
                    <div class="progress-step" id="step1">
                        <div class="step-icon">
                            <div class="step-number">1</div>
                            <div class="step-spinner" style="display: none;"></div>
                            <div class="step-check" style="display: none;">‚úì</div>
                        </div>
                        <div class="step-content">
                            <div class="step-title">Fetching Code</div>
                            <div class="step-description">Extracting code from the current page</div>
                        </div>
                    </div>
                    
                    <div class="progress-step" id="step2">
                        <div class="step-icon">
                            <div class="step-number">2</div>
                            <div class="step-spinner" style="display: none;"></div>
                            <div class="step-check" style="display: none;">‚úì</div>
                        </div>
                        <div class="step-content">
                            <div class="step-title">Fetching Repository Context</div>
                            <div class="step-description">Analyzing repository structure and dependencies</div>
                        </div>
                    </div>
                    
                    <div class="progress-step" id="step3">
                        <div class="step-icon">
                            <div class="step-number">3</div>
                            <div class="step-spinner" style="display: none;"></div>
                            <div class="step-check" style="display: none;">‚úì</div>
                        </div>
                        <div class="step-content">
                            <div class="step-title">Analyzing Code</div>
                            <div class="step-description">Understanding code structure and patterns</div>
                        </div>
                    </div>
                    
                    <div class="progress-step" id="step4">
                        <div class="step-icon">
                            <div class="step-number">4</div>
                            <div class="step-spinner" style="display: none;"></div>
                            <div class="step-check" style="display: none;">‚úì</div>
                        </div>
                        <div class="step-content">
                            <div class="step-title">Generating Test Cases</div>
                            <div class="step-description">Creating comprehensive test scenarios</div>
                        </div>
                    </div>
                    
                    <div class="progress-step" id="step5">
                        <div class="step-icon">
                            <div class="step-number">5</div>
                            <div class="step-spinner" style="display: none;"></div>
                            <div class="step-check" style="display: none;">‚úì</div>
                        </div>
                        <div class="step-content">
                            <div class="step-title">Formatting Results</div>
                            <div class="step-description">Organizing and formatting test cases</div>
                        </div>
                    </div>
                </div>
                
                <div class="progress-bar-container">
                    <div id="progressBar" class="progress-bar"></div>
                </div>
                
                <div class="progress-summary">
                    <p id="progressText" class="progress-text">Starting test generation...</p>
                    <div class="progress-percentage" id="progressPercentage">0%</div>
                </div>
            </div>
            
            <div class="test-type-section">
                <div class="option-group">
                    <label for="testType" class="section-label">Test Type <span class="info-icon" title="Select the type of tests to generate (Unit, Integration, API, E2E, or all).">i</span></label>
                    <select id="testType" class="setting-select">
                        <option value="unit">Unit Tests</option>
                        <option value="integration">Integration Tests</option>
                        <option value="api">API Tests</option>
                        <option value="e2e">End-to-End Tests</option>
                        <option value="all">All Types</option>
                    </select>
                </div>

                <div class="option-group">
                    <label for="contextLevel" class="section-label">Context Level <span class="info-icon" title="Controls how much surrounding code is analyzed. 'Smart' is recommended.">i</span></label>
                    <select id="contextLevel" class="setting-select">
                        <option value="minimal">Minimal</option>
                        <option value="smart" selected>Smart</option>
                        <option value="full">Full</option>
                    </select>
                </div>
            </div>

            <button id="generateBtn" class="btn btn-primary">
                <span class="btn-text">Generate Test Cases</span>
                <span class="loading-spinner" style="display: none;">
                </span>
            </button>

            <div id="resultContainer" class="results-section" style="display: none;">
                <div class="results-header">
                    <h3 class="results-title">Generated Test Cases</h3>
                    <div class="result-actions">
                        <span id="cacheIndicator" class="cache-indicator" style="display: none;" title="Results loaded from cache">üì¶</span>
                        <button id="copyBtn" class="icon-btn" title="Copy to clipboard" disabled>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M10.5 2.5H12.5C13.0523 2.5 13.5 2.94772 13.5 3.5V13.5C13.5 14.0523 13.0523 14.5 12.5 14.5H6.5C5.94772 14.5 5.5 14.0523 5.5 13.5V12" stroke="currentColor" stroke-width="1.5"/>
                                <rect x="2.5" y="1.5" width="8" height="10" rx="1" stroke="currentColor" stroke-width="1.5"/>
                            </svg>
                        </button>
                        <button id="downloadBtn" class="icon-btn" title="Download" disabled>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M8 10.5V2M8 10.5L5 7.5M8 10.5L11 7.5M2.5 14H13.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <pre id="resultContent" class="results-content"></pre>
            </div>

            <div id="errorContainer" class="error-container" style="display: none;">
                <div class="error-icon">‚ö†Ô∏è</div>
                <p id="errorMessage" class="error-message"></p>
            </div>

            <!-- Results Container -->
            <div id="resultsContainer" class="results-container" style="display: none;">
                <!-- Context Verification Panel -->
                <div id="contextVerification" class="context-verification" style="display: none;">
                    <div class="verification-header">
                        <h3>üîç Full Context Verification</h3>
                        <p class="verification-subtitle">Repository analysis completed</p>
                    </div>
                    <div class="verification-content">
                        <div class="verification-item">
                            <span class="verification-label">Method:</span>
                            <span id="verificationMethod" class="verification-value">-</span>
                        </div>
                        <div class="verification-item">
                            <span class="verification-label">Files Analyzed:</span>
                            <span id="verificationFiles" class="verification-value">-</span>
                        </div>
                        <div class="verification-item">
                            <span class="verification-label">Testing Framework:</span>
                            <span id="verificationFramework" class="verification-value">-</span>
                        </div>
                        <div class="verification-item">
                            <span class="verification-label">Dependencies:</span>
                            <span id="verificationDeps" class="verification-value">-</span>
                        </div>
                        <div class="verification-item">
                            <span class="verification-label">Test Patterns:</span>
                            <span id="verificationPatterns" class="verification-value">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="results-header">
                    <h3>Generated Test Cases</h3>
                    <div class="results-actions">
                        <button id="copyBtn" class="copy-btn" title="Copy to clipboard">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M4 2H2C1.44772 2 1 2.44772 1 3V13C1 13.5523 1.44772 14 2 14H10C10.5523 14 11 13.5523 11 13V11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                <path d="M6 1H14C14.5523 1 15 1.44772 15 2V10C15 10.5523 14.5523 11 14 11H6C5.44772 11 5 10.5523 5 10V2C5 1.44772 5.44772 1 6 1Z" stroke="currentColor" stroke-width="1.5"/>
                            </svg>
                            Copy
                        </button>
                        <button id="downloadBtn" class="download-btn" title="Download as file">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 1V11M8 11L11 8M8 11L5 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M1 13H15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                            Download
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <footer class="footer">
            <a href="#" id="helpLink">Help</a>
            <span class="separator">‚Ä¢</span>
            <a href="#" id="feedbackLink">Feedback</a>
        </footer>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button id="closeSettingsBtn" class="modal-close">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="setting-group">
                    <label for="apiKey" class="setting-label">AI Provider API Key <span class="info-icon" title="Your API key for AI providers (OpenAI, Anthropic, etc.). Stored with AES-256 encryption.">i</span></label>
                    <div class="api-key-input-group">
                        <input type="password" id="apiKey" class="setting-input" placeholder="sk-...">
                        <button id="toggleApiKeyBtn" class="icon-btn" type="button">üëÅÔ∏è‚Äçüó®Ô∏è</button>
                    </div>
                    <p class="setting-help">Your API key is encrypted with AES-256-GCM and stored locally</p>
                </div>

                <div class="setting-group">
                    <label for="gitlabToken" class="setting-label">GitLab Token (Optional) <span class="info-icon" title="Personal access token for better GitLab repository analysis. Requires 'read_repository' scope.">i</span></label>
                    <div class="api-key-input-group">
                        <input type="password" id="gitlabToken" class="setting-input" placeholder="glpat-...">
                        <button id="toggleGitlabTokenBtn" class="icon-btn" type="button">üëÅÔ∏è‚Äçüó®Ô∏è</button>
                        <button id="testGitlabTokenBtn" class="test-token-btn" type="button" title="Test GitLab token">üîç</button>
                    </div>
                    <p class="setting-help">Enables private repository access and better context analysis</p>
                </div>

                <div class="setting-group">
                    <label for="model" class="setting-label">AI Model <span class="info-icon" title="Choose the GPT model for test generation. Stronger models are more capable but slower.">i</span></label>
                    <select id="model" class="setting-select">
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>

                <div class="setting-group">
                    <label for="customSelectors" class="setting-label">Custom Selectors <span class="info-icon" title="Add CSS selectors to help the extension find code on specific websites.">i</span></label>
                    <textarea id="customSelectors" class="setting-textarea" rows="3" placeholder="Enter CSS selectors, one per line"></textarea>
                    <p class="setting-help">Add custom CSS selectors to extract code from specific elements</p>
                </div>

                <div class="setting-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="autoCache" class="checkbox" checked>
                        <span>Enable caching (1 hour)</span>
                        <span class="info-icon" title="Temporarily saves generated tests for the same code to reduce API calls.">i</span>
                    </label>
                </div>

                <div class="setting-group">
                    <label for="testMode" class="setting-label">Test Generation Mode <span class="info-icon" title="'Implementation' generates full test code. 'Descriptions' is faster and cheaper.">i</span></label>
                    <select id="testMode" class="setting-select">
                        <option value="descriptions">Test Descriptions Only</option>
                        <option value="implementation" selected>Full Test Implementation</option>
                    </select>
                </div>

                <div id="e2eFrameworkGroup" class="setting-group" style="display: none;">
                    <label for="e2eFramework" class="setting-label">E2E Framework <span class="info-icon" title="Select your preferred framework for end-to-end tests.">i</span></label>
                    <select id="e2eFramework" class="setting-select">
                        <option value="playwright">Playwright</option>
                        <option value="cypress">Cypress</option>
                        <option value="puppeteer">Puppeteer</option>
                        <option value="selenium">Selenium</option>
                        <option value="testcafe">TestCafe</option>
                        <option value="webdriverio">WebdriverIO</option>
                    </select>
                </div>
            </div>

            <div class="modal-footer">
                <button id="saveSettingsBtn" class="btn btn-primary">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Load the bundled popup script -->
    <script type="module" src="../popup.js"></script>
</body>
</html>